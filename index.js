var TelegramBot = require('node-telegram-bot-api'),
// Be sure to replace YOUR_BOT_TOKEN with your actual bot token on this line.
telegram = new TelegramBot("YOUR_BOT_TOKEN", { polling: true });

var whiteSpace = 'ðŸ˜';
var encodedFlag = 'ðŸ‘†ðŸ‘‡ðŸ‘ˆðŸ‘‰';

var alpha = {
	'0': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'1': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'2': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	'3': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Š',
	'4': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸',
	'5': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Š',
	'6': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸',
	'7': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Š',
	'8': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'9': 'â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'A': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'B': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	'C': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Š',
	'D': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸',
	'E': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Š',
	'F': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸',
	'G': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Š',
	'H': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'I': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'J': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	'K': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Š',
	'L': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸',
	'M': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Š',
	'N': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸',
	'O': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜ŠðŸ˜Š',
	'P': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'Q': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'R': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	'S': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Š',
	'T': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸',
	'U': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Š',
	'V': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸',
	'W': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Š',
	'X': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'Y': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'Z': 'â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	'a': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'b': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	'c': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Š',
	'd': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸',
	'e': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Š',
	'f': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸',
	'g': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Š',
	'h': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'i': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'j': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	'k': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Š',
	'l': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸',
	'm': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Š',
	'n': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸',
	'o': 'â˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜ŠðŸ˜Š',
	'p': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'q': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'r': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Šâ˜¹ï¸',
	's': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜ŠðŸ˜Š',
	't': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸â˜¹ï¸',
	'u': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸ðŸ˜Š',
	'v': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜Šâ˜¹ï¸',
	'w': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜Š',
	'x': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸â˜¹ï¸',
	'y': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸â˜¹ï¸ðŸ˜Š',
	'z': 'â˜¹ï¸ðŸ˜ŠðŸ˜ŠðŸ˜ŠðŸ˜Šâ˜¹ï¸ðŸ˜Šâ˜¹ï¸'
};



telegram.on("text", (message) => {
    
    var bin;

    if(!isEncoded(message.text))
        bin = encode(message.text);
    else 
        bin = decode(message.text);

    telegram.sendMessage(message.chat.id, bin);


});

function isEncoded(text){
    var flag = "";
    for(var i=0; i<encodedFlag.length; i++)
        flag += text[i%text.length];
    
    return flag == encodedFlag;
}

function encode(texts){
    var encoded = encodedFlag;
    for(text of texts){
        if(alpha[text] != null )
            encoded += alpha[text]+' ';
        else if(text == ' ')
            encoded += whiteSpace+' ';
        else 
            encoded += text+' ';
    }
        

    return encoded;
}



function decode(texts){
	texts = removeFlag(texts);
	var splits = texts.split(' ');
	splits.pop();//remoiving last null
	

	var decoded = "";

	for(split of splits)
		if(split == whiteSpace && split.length == 2)
			decoded += ' ';
		else if(split.length == 1)
			decoded += split;
		else 
			decoded += getKey(split);
	
	
	return decoded;
}


function getKey(text){
    return Object.keys(alpha).find(key => alpha[key] === text);
}

function removeFlag(text){
	var noFLag = "";
	for(var i = 8; i<text.length; i++)
		noFLag+= text[i];
	return noFLag;

}
